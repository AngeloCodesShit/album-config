
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuratore Album - Studio Andrea Materia</title>
    
    <!-- 1. External Libraries (Tailwind, React, Babel) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
<<<<<<< HEAD
        
        /* Animation Utilities */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Print Configuration */
        @media print {
            .no-print { display: none !important; }
            body { background: white; color: black; }
            #root { max-width: 100%; margin: 0; padding: 0; }
            .print-only { display: block !important; }
            
            /* Clean up UI for print */
            .shadow-xl, .shadow-md, .shadow-sm, .shadow-lg { box-shadow: none !important; }
            .border { border: 1px solid #e2e8f0 !important; }
            
            /* Ensure colors print correctly */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            /* Hide URL headers/footers in modern browsers if supported (optional) */
            @page { margin: 1cm; }
        }
        .print-only { display: none; }
=======
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
    </style>
<script type="importmap">
{
  "imports": {
<<<<<<< HEAD
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.2.7",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
=======
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900">
    
    <div id="root"></div>

    <script type="text/babel">
        
        /********************************************************************************
<<<<<<< HEAD
         *  1. DATA & CONFIGURATION
         ********************************************************************************/
        const PRICE_MULTIPLIER = 1.5;
        const COST_PER_ADDITIONAL_SPREAD = 7.92;
        const STANDARD_SPREADS = 30; 
        const INCLUDED_MINIS = 2;    
        const EXTRA_MINI_BASE_COST = 50.00; 

        // --- EXTRAS ---
        const EXTRAS = [
            { id: 'led', name: 'Supplemento LED', cost: 100.00, allowQuantity: false },
=======
         *  DATI E CONFIGURAZIONE
         ********************************************************************************/
        const PRICE_MULTIPLIER = 1.5;
        const COST_PER_ADDITIONAL_SPREAD = 7.92;
        const STANDARD_SPREADS = 30;
        const INCLUDED_MINIS = 2;
        const EXTRA_MINI_BASE_COST = 50.00; // Aggiornato a 50€

        // --- EXTRAS ---
        const EXTRAS = [
            { id: 'led', name: 'Supplemento LED', cost: 100.00, allowQuantity: false }, // Aggiornato a 100€
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            { id: 'tamponatura', name: 'Supplemento Tamponatura', cost: 20.00, allowQuantity: false },
            { id: 'legno', name: 'Supplemento Legno (No Alpi)', cost: 40.00, allowQuantity: false },
            { id: 'cartoncino', name: 'Cartoncino Personalizzato', cost: 4.40, allowQuantity: true },
            { id: 'touch', name: 'Touch', cost: 2.24, allowQuantity: true },
            { id: 'velina', name: 'Velina HD', cost: 5.68, allowQuantity: true },
            { id: 'riporto', name: 'Riporto', cost: 12.00, allowQuantity: true },
        ];

<<<<<<< HEAD
        // --- SPINES (MAIN ALBUM) ---
        const SPINE_OPTIONS = [
            { id: 'spine_coagulato', name: 'Coagulato / Woodplus (Base)', cost: 0, category: 'Base' },
            { id: 'spine_alcantara', name: 'Alcantara / Velur', cost: 15.00, category: 'Upgrade' }, 
=======
        // --- MATERIALI COSTE & COPERTINE (Prezzi dal PDF) ---
        // Usiamo la stessa lista per Coste e Copertine Mini dove possibile, o definizioni specifiche
        const SPINE_OPTIONS = [
            { id: 'spine_coagulato', name: 'Coagulato / Woodplus (Base)', cost: 0, category: 'Base' },
            { id: 'spine_alcantara', name: 'Alcantara / Velur', cost: 15.00, category: 'Upgrade' }, // Prezzo stimato dai supplementi mini
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            { id: 'spine_majolike', name: 'Majolike', cost: 70.00, category: 'Upgrade' },
            { id: 'spine_sense', name: 'Sense / Kamur', cost: 90.00, category: 'Upgrade' },
            { id: 'spine_groove', name: 'Groove', cost: 110.00, category: 'Upgrade' },
            { id: 'spine_stone', name: 'Woodplus Stone', cost: 120.00, category: 'Upgrade' },
            { id: 'spine_pelle', name: 'Pelle / Derma / Fragma', cost: 140.00, category: 'Upgrade' },
            { id: 'spine_triade', name: 'Triade', cost: 160.00, category: 'Upgrade' },
        ];

<<<<<<< HEAD
        // --- SPINES (MINI ALBUM) ---
        const MINI_SPINE_OPTIONS = [
            { id: 'mini_spine_coagulato', name: 'Coagulato (Incluso)', cost: 0 },
            { id: 'mini_spine_alcantara', name: 'Alcantara / Velur', cost: 15.00 },
            { id: 'mini_spine_kamur', name: 'Kamur', cost: 18.00 },
            { id: 'mini_spine_derma', name: 'Derma / Pelle', cost: 20.00 },
            { id: 'mini_spine_majolike', name: 'Majolike', cost: 65.00 },
            { id: 'mini_spine_sense', name: 'Sense', cost: 80.00 },
            { id: 'mini_spine_groove', name: 'Groove', cost: 90.00 },
            { id: 'mini_spine_stone', name: 'Woodplus Stone', cost: 100.00 },
            { id: 'mini_spine_fragma', name: 'Fragma / Genesi', cost: 120.00 },
            { id: 'mini_spine_triade', name: 'Triade', cost: 140.00 },
        ];

        // --- COVERS (MINI ALBUM) ---
=======
        // --- MINI COVERS ---
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
        const MINI_COVER_OPTIONS = [
            { id: 'mini_coagulato', name: 'Coagulato (Incluso)', cost: 0, category: 'Base' },
            { id: 'mini_alcantara', name: 'Alcantara / Velur', cost: 15.00, category: 'Upgrade' },
            { id: 'mini_kamur', name: 'Kamur', cost: 18.00, category: 'Upgrade' },
            { id: 'mini_derma', name: 'Derma / Pelle', cost: 20.00, category: 'Upgrade' },
<<<<<<< HEAD
=======
            // Aggiungiamo opzioni più costose dal listino principale per completezza sui mini
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            { id: 'mini_majolike', name: 'Majolike', cost: 65.00, category: 'Upgrade' },
            { id: 'mini_sense', name: 'Sense', cost: 80.00, category: 'Upgrade' },
        ];

        // --- COVERS (MAIN ALBUM) ---
        const COVER_UPGRADES = [
            { id: 'std_woodplus', name: 'Woodplus (02-07-03-04-04 bicolor-08)', cost: 0, category: 'Base' },
            { id: 'std_vitro', name: 'Vitro', cost: 0, category: 'Base' },
            { id: 'std_lignum', name: 'Lignum', cost: 0, category: 'Base' },
            { id: 'std_opaque', name: 'Opaque (01-02-18)', cost: 0, category: 'Base' },
            { id: 'std_brandline', name: 'Brandline 24', cost: 0, category: 'Base' },
            { id: 'std_shabby', name: 'Shabby', cost: 0, category: 'Base' },

            { id: 'majolike', name: 'Majolike', cost: 70.00, category: 'Upgrade' }, 
            { id: 'majolike_sm', name: 'Majolike (Small)', cost: 65.00, category: 'Upgrade' }, 
            { id: 'majolike_lg', name: 'Majolike (Large)', cost: 80.00, category: 'Upgrade' }, 
            
            { id: 'sense', name: 'Sense (01-02)', cost: 90.00, category: 'Upgrade' }, 
            { id: 'sense_sm', name: 'Sense (Small)', cost: 80.00, category: 'Upgrade' }, 
            { id: 'sense_lg', name: 'Sense (Large)', cost: 100.00, category: 'Upgrade' }, 

            { id: 'groove', name: 'Groove', cost: 110.00, category: 'Upgrade' },
            { id: 'groove_sm', name: 'Groove (Small)', cost: 100.00, category: 'Upgrade' },
            { id: 'groove_lg', name: 'Groove (Large)', cost: 120.00, category: 'Upgrade' },

            { id: 'stone', name: 'Woodplus Stone', cost: 120.00, category: 'Upgrade' },
            { id: 'stone_sm', name: 'Woodplus Stone (Small)', cost: 110.00, category: 'Upgrade' },
            { id: 'stone_lg', name: 'Woodplus Stone (Large)', cost: 135.00, category: 'Upgrade' },

            { id: 'fragma', name: 'Fragma / Genesi / Loft / Pure', cost: 140.00, category: 'Upgrade' },
            { id: 'fragma_sm', name: 'Fragma / Genesi / Loft / Pure (Small)', cost: 125.00, category: 'Upgrade' },
            { id: 'fragma_lg', name: 'Fragma / Genesi / Loft / Pure (Large)', cost: 155.00, category: 'Upgrade' },
            
            { id: 'patch', name: 'Patch / Grance / Let Her', cost: 80.00, category: 'Upgrade' },
            { id: 'patch_sm', name: 'Patch / Grance / Let Her (Small)', cost: 70.00, category: 'Upgrade' },
            { id: 'patch_lg', name: 'Patch / Grance / Let Her (Large)', cost: 90.00, category: 'Upgrade' },

            { id: 'triade', name: 'Triade', cost: 160.00, category: 'Upgrade' },
            { id: 'triade_sm', name: 'Triade (Small)', cost: 145.00, category: 'Upgrade' },
            { id: 'triade_lg', name: 'Triade (Large)', cost: 175.00, category: 'Upgrade' },
        ];

        // --- BOX OPTIONS ---
        const BOX_OPTIONS = [
            { id: 'base_box', name: 'Recordia Box / Oyster / Girevole Semplice', cost: 0, includedWithBase: true },
            { id: 'mark_ii', name: 'Mark II, Vitro, Vitro Evo, True, Brooklyn', cost: 0.00 },
            { id: 'design_group', name: 'Mark II Lignum, Eclipse, Design', cost: 50.00 },
            { id: 'louvre', name: 'Louvre, Artika', cost: 100.00 },
            { id: 'lumiere', name: 'Lumiere', cost: 70.00 },
            { id: 'loft_group', name: 'Loft, Artika Plus, Monolite, Pure', cost: 130.00 },
            { id: 'hashtag', name: 'Hashtag', cost: 120.00 },
            { id: 'genesi_box', name: 'Genesi Box', cost: 180.00 },
            { id: 'triade_box', name: 'Triade Box', cost: 200.00 },
        ];

        // --- ALBUMS ---
        const ALBUMS = [
            {
                id: '40x30',
                name: 'Photoalbum 40x30',
                dimensions: '40x30',
                cost: 370.00,
<<<<<<< HEAD
                description: 'Standard',
                compatibleBoxIds: ['base_box', 'mark_ii', 'design_group', 'louvre', 'lumiere', 'loft_group', 'hashtag', 'genesi_box', 'triade_box'],
=======
                description: '30 Interni • 2 Mini Inclusi',
                compatibleBoxIds: ['base_box', 'mark_ii', 'design_group', 'louvre', 'lumiere', 'loft_group', 'hashtag', 'genesi_box', 'triade_box'],
                allowBasicOption: true // Abilita checkbox "Basic"
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            },
            {
                id: '35x25',
                name: 'Photoalbum 35x25',
                dimensions: '35x25',
                cost: 370.00,
                description: 'Standard',
                compatibleBoxIds: ['base_box', 'mark_ii', 'design_group', 'louvre', 'lumiere', 'loft_group', 'hashtag', 'genesi_box', 'triade_box']
            },
            {
                id: '45x35',
                name: 'Photoalbum 45x35',
                dimensions: '45x35',
                cost: 370.00,
                description: 'Standard',
                compatibleBoxIds: ['base_box', 'mark_ii', 'design_group', 'louvre', 'lumiere', 'loft_group', 'hashtag', 'genesi_box', 'triade_box']
            },
            {
                id: 'battesimo',
                name: 'Battesimo 35x25',
                dimensions: '35x25',
                cost: 180.00,
                description: 'Standard',
                compatibleBoxIds: ['base_box'] 
            }
        ];

        // --- HELPER: Get Compatible Covers ---
        const getCompatibleCovers = (albumId) => {
            if (!albumId) return [];
            const baseCovers = COVER_UPGRADES.filter(c => c.category === 'Base');
            
            let suffix = '';
            if (albumId === '35x25' || albumId === 'battesimo') suffix = '_sm';
            else if (albumId === '45x35') suffix = '_lg';

            const upgradeCovers = COVER_UPGRADES.filter(c => {
                if (c.category === 'Base') return false;
                if (albumId === '40x30' && !c.id.includes('_sm') && !c.id.includes('_lg')) return true;
                if (c.id.endsWith(suffix)) return true;
                return false;
            });

            return [...baseCovers, ...upgradeCovers];
        };

        /********************************************************************************
         *  2. COMPONENTS
         ********************************************************************************/
        
        const { useState, useMemo, useEffect } = React;

<<<<<<< HEAD
        // --- Component: Selection Card ---
        const SelectionCard = ({ 
            item, 
            isSelected, 
            onSelect, 
            quantity = 0, 
            onQuantityChange, 
            extraContent,
            isIncluded = false,
            onToggleIncluded
        }) => {
=======
        // --- Selection Card ---
        const SelectionCard = ({ item, isSelected, onSelect, quantity = 0, onQuantityChange, extraContent }) => {
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            const isQuantityEnabled = item.allowQuantity;

            const handleIncrement = (e) => {
                e.stopPropagation();
                if (onQuantityChange) onQuantityChange(quantity + 1);
            };

            const handleDecrement = (e) => {
                e.stopPropagation();
                if (onQuantityChange && quantity > 0) onQuantityChange(quantity - 1);
            };

            const handleToggleIncluded = (e) => {
                e.stopPropagation();
                if (onToggleIncluded) onToggleIncluded(e.target.checked);
            }

            return (
                <div 
                    onClick={isQuantityEnabled ? undefined : onSelect}
                    className={`
                        relative rounded-xl border-2 p-4 transition-all duration-200 cursor-pointer
                        ${isSelected || (isQuantityEnabled && quantity > 0)
                        ? 'border-indigo-600 bg-indigo-50 shadow-md' 
                        : 'border-slate-200 bg-white hover:border-indigo-300 hover:shadow-sm'}
                    `}
                >
                    <div className="flex justify-between items-start">
                        <div className="flex-1 pr-4">
                            <h3 className={`font-semibold text-sm md:text-base ${isSelected || quantity > 0 ? 'text-indigo-900' : 'text-slate-800'}`}>
                                {item.name}
                            </h3>
                            {item.description && (
                                <p className="text-xs text-slate-500 mt-1">{item.description}</p>
                            )}
                            {extraContent}
                        </div>
                        
                        <div className="text-right">
                            <span className={`block font-bold text-sm ${isSelected || quantity > 0 ? 'text-indigo-700' : 'text-slate-700'}`}>
                                {item.cost === 0 || isIncluded ? 'Incl.' : `+€${item.cost.toFixed(2)}`}
                            </span>
                            
                            {!isQuantityEnabled && isSelected && (
                                <div className="mt-2 text-indigo-600">
                                    <div className="w-4 h-4 rounded-full bg-indigo-600 ml-auto" />
                                </div>
                            )}
                        </div>
                    </div>

                    {isQuantityEnabled && (
                        <div className="mt-4 flex items-center justify-end gap-3 border-t border-indigo-100 pt-3">
                            <button 
                                onClick={handleDecrement}
                                disabled={quantity === 0}
                                className={`w-8 h-8 rounded-full flex items-center justify-center text-lg font-bold transition-colors
                                ${quantity === 0 ? 'bg-slate-100 text-slate-300' : 'bg-white text-indigo-600 border border-indigo-200 hover:bg-indigo-50'}`}
                            >
                                -
                            </button>
                            <span className={`font-mono text-lg font-bold w-6 text-center ${quantity > 0 ? 'text-indigo-900' : 'text-slate-400'}`}>
                                {quantity}
                            </span>
                            <button 
                                onClick={handleIncrement}
                                className="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center text-lg font-bold hover:bg-indigo-700 transition-colors shadow-sm"
                            >
                                +
                            </button>
                        </div>
                    )}

                    {/* Checkbox "Incluso nel contratto" - Visibile solo se selezionato o quantità > 0 e se la funzione è passata */}
                    {(isSelected || quantity > 0) && onToggleIncluded && (
                        <div 
                            className="mt-3 pt-2 border-t border-indigo-200 flex items-center gap-2"
                            onClick={(e) => e.stopPropagation()} 
                        >
                            <input 
                                type="checkbox" 
                                id={`included-${item.id}`}
                                checked={isIncluded} 
                                onChange={handleToggleIncluded}
                                className="w-4 h-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500"
                            />
                            <label htmlFor={`included-${item.id}`} className="text-xs font-medium text-slate-700 cursor-pointer select-none">
                                Incluso nel contratto
                            </label>
                        </div>
                    )}
                </div>
            );
        };

<<<<<<< HEAD
        // --- Component: Summary Sidebar ---
        const Summary = ({ contract, album, spreadCount, cover, spine, box, extras, includedExtraIds, miniCount, miniCover, miniSpine, onReset }) => {
=======
        // --- Summary Row Helper ---
        const SummaryRow = ({ label, sublabel, cost, isHeader = false, highlight = false, multiplier = PRICE_MULTIPLIER }) => {
            const clientPrice = cost * multiplier;
            return (
                <div className={`grid grid-cols-12 gap-2 text-sm py-2 ${isHeader ? 'font-bold text-slate-800 border-b border-slate-300 mb-2' : 'border-b border-slate-50 last:border-0'}`}>
                    <div className="col-span-6 flex flex-col justify-center">
                        <span className={`${highlight ? 'text-indigo-700 font-semibold' : 'text-slate-700'}`}>{label}</span>
                        {sublabel && <span className="text-xs text-slate-400">{sublabel}</span>}
                    </div>
                    <div className="col-span-3 text-right text-slate-500 font-mono flex items-center justify-end">
                        {isHeader ? 'Studio' : `€${cost.toFixed(2)}`}
                    </div>
                    <div className="col-span-3 text-right font-bold text-indigo-700 font-mono flex items-center justify-end bg-indigo-50/50 rounded px-1">
                        {isHeader ? 'Cliente' : `€${clientPrice.toFixed(2)}`}
                    </div>
                </div>
            );
        };

        // --- Summary (Sidebar) ---
        const Summary = ({ album, isBasicPackage, spreadCount, cover, spine, box, extras, miniCount, miniCover, miniSpine, onReset }) => {
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            const [vatRate, setVatRate] = useState(22);

            // 1. Spreads Adjustment
            const spreadDiff = spreadCount - contract.includedSpreads;
            const spreadCostAdjustment = spreadDiff * COST_PER_ADDITIONAL_SPREAD;

            // 2. Supplementi Standard
            const coverCost = cover?.cost || 0;
            const spineCost = spine?.cost || 0;
            const boxCost = box?.cost || 0;

<<<<<<< HEAD
            // 3. Mini Albums
            const extraMinis = Math.max(0, miniCount - contract.includedMinis);
            const miniBaseCostTotal = extraMinis * EXTRA_MINI_BASE_COST;
            const miniCoverCostTotal = miniCover ? (miniCount * miniCover.cost) : 0;
            const miniSpineCostTotal = miniSpine ? (miniCount * miniSpine.cost) : 0;
            const totalMiniVariations = miniBaseCostTotal + miniCoverCostTotal + miniSpineCostTotal;

            // 4. Extras (Separazione tra pagati e inclusi)
            const paidExtras = extras.filter(e => !includedExtraIds.includes(e.item.id));
            const includedExtrasList = extras.filter(e => includedExtraIds.includes(e.item.id));
            
            const extrasCost = paidExtras.reduce((sum, { item, quantity }) => sum + (item.cost * quantity), 0);
            
            // TOTALI
            const totalVariationsCostStudio = spreadCostAdjustment + coverCost + spineCost + boxCost + totalMiniVariations + extrasCost;
            const totalVariationsPriceClient = totalVariationsCostStudio * PRICE_MULTIPLIER;

            const finalPriceClient = contract.agreedPrice + totalVariationsPriceClient;
            const priceWithVat = finalPriceClient * (1 + vatRate / 100);

            const handlePrint = () => {
                window.print();
            };
=======
            // Mini Logic
            const extraMinis = Math.max(0, miniCount - INCLUDED_MINIS);
            // Ogni mini extra costa 50€ di base
            const miniBaseCostTotal = extraMinis * EXTRA_MINI_BASE_COST;
            // Le copertine e le coste si pagano per OGNI mini (anche quelli inclusi nel numero base, se sono upgrade)
            const miniCoverCostTotal = miniCover ? (miniCount * miniCover.cost) : 0;
            const miniSpineCostTotal = miniSpine ? (miniCount * miniSpine.cost) : 0;
            const totalMiniCost = miniBaseCostTotal + miniCoverCostTotal + miniSpineCostTotal;

            const extrasCost = extras.reduce((sum, { item, quantity }) => sum + (item.cost * quantity), 0);
            
            const totalCost = baseCost + spreadCostAdjustment + coverCost + spineCost + boxCost + totalMiniCost + extrasCost;
            
            // Basic Package Logic (Difference calculation)
            const diffFromBase = totalCost - (album ? album.cost : 0);

            const sellPrice = totalCost * PRICE_MULTIPLIER;
            const priceWithVat = sellPrice * (1 + vatRate / 100);
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad

            return (
                <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden sticky top-6">
                    <div className="bg-slate-900 p-4 flex justify-between items-center no-print">
                        <h2 className="text-white font-bold text-lg flex items-center gap-2">
                             <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                            Riepilogo
                        </h2>
<<<<<<< HEAD
                        <div className="flex gap-2">
                             <button onClick={handlePrint} className="text-xs bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded-md border border-indigo-500 flex items-center gap-1">
                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                                Stampa
                            </button>
                            <button onClick={onReset} className="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded-md border border-slate-600">Reset</button>
                        </div>
                    </div>
                    
                    {/* Header Contratto */}
                    <div className="bg-slate-50 p-4 border-b border-slate-200">
                        <div className="text-xs text-slate-400 font-bold uppercase tracking-wider mb-2">Base Contratto</div>
                        <div className="flex justify-between items-center mb-1">
                            <span className="font-semibold text-slate-700">{contract.clientName || 'Cliente'}</span>
                            <span className="font-bold text-slate-900">€{contract.agreedPrice.toFixed(2)}</span>
                        </div>
                        <div className="text-xs text-slate-500 flex flex-wrap gap-x-3 gap-y-1">
                            <span>• {album?.name}</span>
                            <span>• Formato {album?.dimensions}</span>
                            <span>• {contract.includedSpreads} Interni</span>
                            <span>• {contract.includedMinis} Mini</span>
                        </div>
                        
                        {/* Lista Extra Inclusi */}
                        {includedExtrasList.length > 0 && (
                            <div className="mt-3 pt-2 border-t border-slate-200">
                                <span className="text-[10px] uppercase font-bold text-slate-400 block mb-1">Extra Inclusi:</span>
                                <div className="text-xs text-slate-600 flex flex-wrap gap-2">
                                    {includedExtrasList.map(e => (
                                        <span key={e.item.id} className="bg-white border border-slate-200 px-1.5 py-0.5 rounded">
                                            {e.item.name} {e.quantity > 1 ? `(x${e.quantity})` : ''}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <div className="p-4">
                        <div className="pb-2 border-b border-slate-100 flex justify-between items-end mb-2">
                            <h3 className="text-sm font-bold text-indigo-900 uppercase tracking-wide">Aggiunte / Variazioni</h3>
                        </div>

                        {/* List Items (Solo Variazioni Pagate) */}
                        <div className="space-y-2">
                            {spreadDiff !== 0 && (
                                <div className="flex justify-between text-sm text-slate-600">
                                    <span>{spreadDiff > 0 ? `+${spreadDiff}` : spreadDiff} Interni Extra</span>
                                    <span className="font-medium text-slate-800">{spreadDiff > 0 ? '+' : ''}€{(spreadCostAdjustment * PRICE_MULTIPLIER).toFixed(2)}</span>
                                </div>
                            )}

                            {cover && cover.cost > 0 && (
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600">Upgrade Cover <span className="text-xs text-slate-400 block">{cover.name}</span></span>
                                    <span className="font-medium">€{(cover.cost * PRICE_MULTIPLIER).toFixed(2)}</span>
                                </div>
                            )}

                            {spine && spine.cost > 0 && (
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600">Upgrade Costa <span className="text-xs text-slate-400 block">{spine.name}</span></span>
                                    <span className="font-medium">€{(spine.cost * PRICE_MULTIPLIER).toFixed(2)}</span>
                                </div>
                            )}

                             {box && box.cost > 0 && (
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600">Box <span className="text-xs text-slate-400 block">{box.name}</span></span>
                                    <span className="font-medium">€{(box.cost * PRICE_MULTIPLIER).toFixed(2)}</span>
                                </div>
                            )}

                            {(extraMinis > 0 || miniCoverCostTotal > 0 || miniSpineCostTotal > 0) && (
                                <div className="border-t border-slate-100 pt-2 mt-2">
                                    {extraMinis > 0 && (
                                        <div className="flex justify-between text-sm">
                                            <span className="text-slate-600">Mini Extra ({extraMinis})</span>
                                            <span className="font-medium">€{(miniBaseCostTotal * PRICE_MULTIPLIER).toFixed(2)}</span>
                                        </div>
                                    )}
                                    {miniCoverCostTotal > 0 && (
                                        <div className="flex justify-between text-sm">
                                            <span className="text-slate-600">Upg. Cover Mini (x{miniCount})</span>
                                            <span className="font-medium">€{(miniCoverCostTotal * PRICE_MULTIPLIER).toFixed(2)}</span>
                                        </div>
                                    )}
                                    {miniSpineCostTotal > 0 && (
                                        <div className="flex justify-between text-sm">
                                            <span className="text-slate-600">Upg. Costa Mini (x{miniCount})</span>
                                            <span className="font-medium">€{(miniSpineCostTotal * PRICE_MULTIPLIER).toFixed(2)}</span>
                                        </div>
                                    )}
                                </div>
                            )}

                            {paidExtras.map(({item, quantity}) => (
                                <div key={item.id} className="flex justify-between text-sm">
                                    <span className="text-slate-600">{quantity > 1 ? `${quantity}x ` : ''}{item.name}</span>
                                    <span className="font-medium">€{(item.cost * quantity * PRICE_MULTIPLIER).toFixed(2)}</span>
                                </div>
                            ))}

                            {totalVariationsPriceClient === 0 && (
                                <div className="text-sm text-slate-400 italic text-center py-2">Nessuna variazione di prezzo.</div>
                            )}
                        </div>

                        {/* Totals */}
                        <div className="border-t-2 border-slate-200 mt-4 pt-3">
                            <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100 mb-4">
                                <div className="flex justify-between items-end">
                                    <div>
                                        <div className="text-xs text-indigo-400 font-bold uppercase tracking-wider mb-1">Totale Finale</div>
                                        <div className="text-xs text-indigo-300">(Contratto + Variazioni)</div>
                                    </div>
                                    <div className="text-3xl font-bold text-indigo-700 leading-none">€{finalPriceClient.toFixed(2)}</div>
                                </div>
                            </div>

                            <div className="flex items-center justify-between p-2 mt-4 bg-slate-100 rounded-lg no-print">
=======
                        <button onClick={onReset} className="text-xs bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded-md border border-slate-600">Reset</button>
                    </div>
                    
                    <div className="p-4">
                        {/* Table Header */}
                        <SummaryRow label="Voce" isHeader />

                        {/* Rows */}
                        <SummaryRow label="Album Base" sublabel={album?.name} cost={album ? album.cost : 0} />
                        
                        {spreadDiff !== 0 && (
                            <SummaryRow 
                                label={`${spreadDiff > 0 ? '+' : ''}${spreadDiff} Interni`} 
                                cost={spreadCostAdjustment} 
                            />
                        )}

                        {(coverCost > 0 || (cover && cover.name !== 'Woodplus')) && (
                             <SummaryRow label="Copertina" sublabel={cover?.name} cost={coverCost} />
                        )}

                        {(spineCost > 0) && (
                            <SummaryRow label="Costa (Dorso)" sublabel={spine?.name} cost={spineCost} />
                        )}

                        {(boxCost > 0) && (
                            <SummaryRow label="Box" sublabel={box?.name} cost={boxCost} />
                        )}

                        {/* Mini Section Summary */}
                        {miniCount > 0 && (
                            <>
                                <div className="border-t border-slate-100 my-1"></div>
                                <SummaryRow label={`Mini Album (${miniCount})`} sublabel={`${extraMinis} Extra a pagamento`} cost={miniBaseCostTotal} />
                                {miniCoverCostTotal > 0 && (
                                    <SummaryRow label="Cover Mini" sublabel={`${miniCover?.name} (x${miniCount})`} cost={miniCoverCostTotal} />
                                )}
                                {miniSpineCostTotal > 0 && (
                                    <SummaryRow label="Costa Mini" sublabel={`${miniSpine?.name} (x${miniCount})`} cost={miniSpineCostTotal} />
                                )}
                            </>
                        )}

                        {/* Extras */}
                        {extras.length > 0 && (
                            <>
                                <div className="border-t border-slate-100 my-1"></div>
                                {extras.map(({item, quantity}) => (
                                    <SummaryRow 
                                        key={item.id}
                                        label={item.name} 
                                        sublabel={quantity > 1 ? `Quantità: ${quantity}` : ''}
                                        cost={item.cost * quantity} 
                                    />
                                ))}
                            </>
                        )}

                        {/* Totals */}
                        <div className="border-t-2 border-slate-200 mt-4 pt-3">
                            
                            {/* Basic Package Highlight */}
                            {isBasicPackage && album && (
                                <div className="bg-orange-50 border border-orange-200 p-3 rounded-lg mb-4 text-center">
                                    <div className="text-xs text-orange-600 uppercase font-bold tracking-wider">Aggiunta al Base</div>
                                    <div className="text-2xl font-bold text-orange-700">€{(diffFromBase * PRICE_MULTIPLIER).toFixed(2)}</div>
                                    <div className="text-[10px] text-orange-400">Differenza Clienti (Totale - €{(album.cost * PRICE_MULTIPLIER).toFixed(2)})</div>
                                </div>
                            )}

                            <div className="flex justify-between items-end mb-1 px-1">
                                <div className="text-xs font-semibold uppercase tracking-wider text-slate-400">Totale Studio</div>
                                <div className="text-lg font-bold text-slate-600">€{totalCost.toFixed(2)}</div>
                            </div>
                            
                            <div className="bg-indigo-600 p-4 rounded-xl shadow-lg shadow-indigo-200 mt-2 text-white">
                                <div className="flex justify-between items-end">
                                    <div>
                                        <div className="text-xs text-indigo-200 font-medium uppercase tracking-wider mb-1">Totale Cliente</div>
                                        <div className="text-3xl font-bold leading-none">€{sellPrice.toFixed(2)}</div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-xs text-indigo-300">Moltiplicatore x{PRICE_MULTIPLIER}</div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex items-center justify-between p-2 mt-4 bg-slate-100 rounded-lg">
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                <div className="flex items-center gap-2">
                                    <label className="text-xs font-semibold text-slate-500 uppercase tracking-wider">IVA (%)</label>
                                    <input 
                                        type="number" min="0" max="100" value={vatRate}
                                        onChange={(e) => setVatRate(Number(e.target.value))}
                                        className="w-14 py-1 px-1 text-center bg-white border border-slate-300 rounded text-sm font-medium outline-none"
                                    />
                                </div>
                                <div className="text-right">
<<<<<<< HEAD
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wide">Totale Ivato</div>
=======
                                    <div className="text-[10px] text-slate-400 uppercase tracking-wide">Ivato Cliente</div>
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                    <div className="text-xl font-bold text-slate-800 leading-none">€{priceWithVat.toFixed(2)}</div>
                                </div>
                            </div>
                            
                            <div className="hidden print-only mt-2 text-right">
                                <div className="text-sm text-slate-500">Totale Ivato ({vatRate}%): <span className="font-bold text-slate-900">€{priceWithVat.toFixed(2)}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        /********************************************************************************
         *  3. MAIN APP
         ********************************************************************************/
        
        const App = () => {
            const INITIAL_STATE = {
<<<<<<< HEAD
                contract: null,
                spreadCount: STANDARD_SPREADS,
                selectedCoverId: null,
                selectedSpineId: SPINE_OPTIONS[0].id, 
                selectedBoxId: null,
                miniCount: INCLUDED_MINIS,
                selectedMiniCoverId: MINI_COVER_OPTIONS[0].id,
                selectedMiniSpineId: MINI_SPINE_OPTIONS[0].id,
                extras: {},
                includedExtraIds: [] // Array di ID degli extra marcati come "Inclusi"
=======
                selectedAlbumId: null,
                isBasicPackage: false,
                spreadCount: STANDARD_SPREADS,
                selectedCoverId: null,
                selectedSpineId: SPINE_OPTIONS[0].id, // Default Spine Base
                selectedBoxId: null,
                miniCount: INCLUDED_MINIS,
                selectedMiniCoverId: MINI_COVER_OPTIONS[0].id,
                selectedMiniSpineId: SPINE_OPTIONS[0].id,
                extras: {}
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            };

            const [state, setState] = useState(INITIAL_STATE);
            
            // Stato temporaneo Setup Contratto
            const [tempContract, setTempContract] = useState({
                clientName: '',
                agreedPrice: 370, // Default base price logic
                albumId: ALBUMS[0].id,
                includedSpreads: STANDARD_SPREADS,
                includedMinis: INCLUDED_MINIS,
                // contractExtrasCost rimosso
            });

            // Logic to Auto-Calculate Contract Price based on inputs
            useEffect(() => {
                const selectedAlbum = ALBUMS.find(a => a.id === tempContract.albumId);
                const albumBaseCost = selectedAlbum ? selectedAlbum.cost : 0;
                
                // Logic: 370 standard includes 2 minis. 
                // If user changes minis, price adjusts by EXTRA_MINI_BASE_COST (50)
                const miniDifference = tempContract.includedMinis - INCLUDED_MINIS; // e.g. 0 - 2 = -2
                const miniAdjustment = miniDifference * EXTRA_MINI_BASE_COST; // -2 * 50 = -100
                
                const calculatedPrice = albumBaseCost + miniAdjustment;

                // Update only the price
                setTempContract(prev => ({ ...prev, agreedPrice: calculatedPrice }));
            }, [tempContract.albumId, tempContract.includedMinis]);


            // Derived Data
            const activeAlbumId = state.contract ? state.contract.albumId : tempContract.albumId;
            const selectedAlbum = useMemo(() => ALBUMS.find(a => a.id === activeAlbumId) || null, [activeAlbumId]);
            const compatibleCovers = useMemo(() => getCompatibleCovers(activeAlbumId), [activeAlbumId]);
            const selectedCover = useMemo(() => compatibleCovers.find(c => c.id === state.selectedCoverId) || null, [compatibleCovers, state.selectedCoverId]);
            const selectedSpine = useMemo(() => SPINE_OPTIONS.find(s => s.id === state.selectedSpineId) || null, [state.selectedSpineId]);
            
            const compatibleBoxes = useMemo(() => {
                if (!selectedAlbum) return [];
                return BOX_OPTIONS.filter(b => selectedAlbum.compatibleBoxIds.includes(b.id));
            }, [selectedAlbum]);
            const selectedBox = useMemo(() => compatibleBoxes.find(b => b.id === state.selectedBoxId) || null, [compatibleBoxes, state.selectedBoxId]);
            
            const selectedMiniCover = useMemo(() => MINI_COVER_OPTIONS.find(c => c.id === state.selectedMiniCoverId) || null, [state.selectedMiniCoverId]);
<<<<<<< HEAD
            const selectedMiniSpine = useMemo(() => MINI_SPINE_OPTIONS.find(s => s.id === state.selectedMiniSpineId) || null, [state.selectedMiniSpineId]);
=======
            const selectedMiniSpine = useMemo(() => SPINE_OPTIONS.find(s => s.id === state.selectedMiniSpineId) || null, [state.selectedMiniSpineId]);
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad

            const selectedExtrasList = useMemo(() => {
                return Object.entries(state.extras)
                    .filter(([_, qty]) => qty > 0)
                    .map(([id, qty]) => {
                        const item = EXTRAS.find(e => e.id === id);
                        return item ? { item, quantity: qty } : null;
                    })
                    .filter(Boolean);
            }, [state.extras]);
            
            // Helper for temp contract display
            const selectedTempAlbum = useMemo(() => ALBUMS.find(a => a.id === tempContract.albumId), [tempContract.albumId]);

            // Handlers
            const handleStartConfiguration = () => {
                if (tempContract.agreedPrice <= 0) {
                    alert("Inserisci un prezzo valido.");
                    return;
                }
                setState(prev => ({
                    ...prev,
<<<<<<< HEAD
                    contract: { ...tempContract },
                    spreadCount: tempContract.includedSpreads,
                    miniCount: tempContract.includedMinis,
                    selectedAlbumId: tempContract.albumId
                }));
            };

            const handleReset = () => {
                if (window.confirm("Sei sicuro? I dati attuali andranno persi.")) {
                    setState(INITIAL_STATE);
                    setTempContract({
                        clientName: '',
                        agreedPrice: 370,
                        albumId: ALBUMS[0].id,
                        includedSpreads: STANDARD_SPREADS,
                        includedMinis: INCLUDED_MINIS
                    });
                }
            };

            const toggleExtraIncluded = (extraId, isIncluded) => {
                setState(prev => {
                    const currentIncluded = new Set(prev.includedExtraIds);
                    if (isIncluded) {
                        currentIncluded.add(extraId);
                    } else {
                        currentIncluded.delete(extraId);
                    }
                    return { ...prev, includedExtraIds: Array.from(currentIncluded) };
                });
            };

            // RENDER SETUP SCREEN
            if (!state.contract) {
                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 animate-fade-in">
                            <div className="flex items-center gap-3 mb-6 text-indigo-900">
                                <div className="p-2 bg-indigo-100 rounded-lg">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                </div>
                                <h1 className="text-2xl font-bold">Dati Contratto</h1>
                            </div>
                            
                            <div className="space-y-5">
                                <div>
                                    <label className="block text-sm font-medium text-slate-700 mb-1">Nome Sposi / Cliente</label>
                                    <input type="text" className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Es. Mario & Rossi" value={tempContract.clientName} onChange={e => setTempContract({...tempContract, clientName: e.target.value})} />
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Modello</label>
                                        <select className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none bg-white" value={tempContract.albumId} onChange={e => setTempContract({...tempContract, albumId: e.target.value})}>
                                            {ALBUMS.map(a => (<option key={a.id} value={a.id}>{a.name}</option>))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Formato</label>
                                        <input type="text" disabled className="w-full px-4 py-2 border border-slate-200 bg-slate-50 text-slate-500 rounded-lg outline-none" value={selectedTempAlbum?.dimensions || ''} />
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Interni Inclusi</label>
                                        <input type="number" className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={tempContract.includedSpreads} onChange={e => setTempContract({...tempContract, includedSpreads: Number(e.target.value)})} />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Mini Inclusi</label>
                                        <input type="number" className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" value={tempContract.includedMinis} onChange={e => setTempContract({...tempContract, includedMinis: Number(e.target.value)})} />
                                    </div>
                                </div>

                                {/* Removed Extra da Contratto Input Field */}

                                <div className="pt-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <label className="block text-sm font-bold text-slate-800 mb-1">Prezzo Concordato (Calcolato)</label>
                                    <div className="relative">
                                        <span className="absolute left-3 top-2 text-slate-400">€</span>
                                        <input type="number" className="w-full pl-8 pr-4 py-2 border-2 border-indigo-100 rounded-lg focus:border-indigo-500 focus:ring-0 outline-none font-bold text-lg text-slate-900 bg-white" placeholder="0.00" value={tempContract.agreedPrice || ''} onChange={e => setTempContract({...tempContract, agreedPrice: Number(e.target.value)})} />
                                    </div>
                                    <p className="text-xs text-slate-500 mt-1">Include {tempContract.includedMinis} Mini</p>
                                </div>

                                <button onClick={handleStartConfiguration} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-indigo-200 mt-4 flex justify-center items-center gap-2">
                                    Inizia Configurazione <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // RENDER MAIN APP
=======
                    selectedAlbumId: id,
                    isBasicPackage: false, // Reset basic flag
                    spreadCount: STANDARD_SPREADS,
                    selectedCoverId: null,
                    selectedBoxId: null
                }));
            };

>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 text-white p-1.5 rounded-lg">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-900 tracking-tight leading-none">Configuratore Album</h1>
                                    <span className="text-xs text-slate-500 font-medium">{state.contract.clientName}</span>
                                </div>
                            </div>
                            <div className="text-sm text-slate-500 hidden sm:block">Studio Fotografico Andrea Materia</div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow w-full">
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
<<<<<<< HEAD
                            <div className="lg:col-span-8 space-y-10 no-print">
                                {/* 1. Album Info (Read Only) */}
=======
                            <div className="lg:col-span-8 space-y-10">
                                
                                {/* 1. Album */}
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                <section className="animate-fade-in">
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-sm font-bold">1</span>
                                        <h2 className="text-xl font-bold text-slate-800">Interni</h2>
                                    </div>
<<<<<<< HEAD
                                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                        <div className="mb-4 pb-4 border-b border-slate-100">
                                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-1">Album Base (da Contratto)</h3>
                                            <div className="text-lg font-semibold text-slate-800">{selectedAlbum?.name}</div>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <label className="font-semibold text-slate-700 block">Numero Interni Totale</label>
                                                <p className="text-xs text-slate-400 mt-1">Inclusi nel contratto: {state.contract.includedSpreads}</p>
                                            </div>
                                            <div className="flex items-center gap-4 bg-slate-50 p-2 rounded-lg border border-slate-200">
                                                <button onClick={() => setState(p => ({...p, spreadCount: Math.max(10, p.spreadCount - 1)}))} className="w-10 h-10 rounded-full bg-white border border-slate-300 font-bold hover:text-indigo-600">-</button>
                                                <span className="text-xl font-bold text-indigo-900 w-12 text-center">{state.spreadCount}</span>
                                                <button onClick={() => setState(p => ({...p, spreadCount: p.spreadCount + 1}))} className="w-10 h-10 rounded-full bg-indigo-600 text-white font-bold hover:bg-indigo-700">+</button>
=======
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                                        {ALBUMS.map(album => (
                                            <SelectionCard
                                                key={album.id}
                                                item={album}
                                                isSelected={state.selectedAlbumId === album.id}
                                                onSelect={() => handleAlbumSelect(album.id)}
                                                extraContent={
                                                    album.allowBasicOption && state.selectedAlbumId === album.id && (
                                                        <div 
                                                            className="mt-3 bg-indigo-100 p-2 rounded-lg flex items-center gap-2"
                                                            onClick={(e) => e.stopPropagation()}
                                                        >
                                                            <input 
                                                                type="checkbox" 
                                                                id="basicPkg"
                                                                checked={state.isBasicPackage}
                                                                onChange={(e) => setState(p => ({...p, isBasicPackage: e.target.checked}))}
                                                                className="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500"
                                                            />
                                                            <label htmlFor="basicPkg" className="text-sm font-semibold text-indigo-900 cursor-pointer select-none">
                                                                Mostra solo aggiunte al Base
                                                            </label>
                                                        </div>
                                                    )
                                                }
                                            />
                                        ))}
                                    </div>
                                    {selectedAlbum && (
                                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <label className="font-semibold text-slate-700 block">Numero Interni</label>
                                                    <p className="text-xs text-slate-400 mt-1">Std: {STANDARD_SPREADS}. Extra: +/- €{COST_PER_ADDITIONAL_SPREAD}</p>
                                                </div>
                                                <div className="flex items-center gap-4 bg-slate-50 p-2 rounded-lg border border-slate-200">
                                                    <button onClick={() => setState(p => ({...p, spreadCount: Math.max(10, p.spreadCount - 1)}))} className="w-10 h-10 rounded-full bg-white border border-slate-300 font-bold hover:text-indigo-600">-</button>
                                                    <span className="text-xl font-bold text-indigo-900 w-12 text-center">{state.spreadCount}</span>
                                                    <button onClick={() => setState(p => ({...p, spreadCount: p.spreadCount + 1}))} className="w-10 h-10 rounded-full bg-indigo-600 text-white font-bold hover:bg-indigo-700">+</button>
                                                </div>
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                {/* 2. Cover & Spine */}
<<<<<<< HEAD
                                <section>
=======
                                <section className={`transition-opacity duration-300 ${!selectedAlbum ? 'opacity-40 pointer-events-none' : 'opacity-100'}`}>
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-sm font-bold">2</span>
                                        <h2 className="text-xl font-bold text-slate-800">Copertina e Costa</h2>
                                    </div>
                                    <div className="space-y-6">
                                        <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                            <h3 className="font-bold text-slate-700 mb-3">Materiale Costa (Dorso)</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
                                                {SPINE_OPTIONS.map(spine => (
                                                    <SelectionCard key={spine.id} item={spine} isSelected={state.selectedSpineId === spine.id} onSelect={() => setState(p => ({...p, selectedSpineId: spine.id}))} />
                                                ))}
                                            </div>
                                        </div>
<<<<<<< HEAD
=======

>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                        <div>
                                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Copertine Base</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                                {compatibleCovers.filter(c => c.category === 'Base').map(c => (
                                                    <SelectionCard key={c.id} item={c} isSelected={state.selectedCoverId === c.id} onSelect={() => setState(p => ({...p, selectedCoverId: c.id}))} />
                                                ))}
                                            </div>
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Copertine Premium</h3>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                                {compatibleCovers.filter(c => c.category === 'Upgrade').map(c => (
                                                    <SelectionCard key={c.id} item={c} isSelected={state.selectedCoverId === c.id} onSelect={() => setState(p => ({...p, selectedCoverId: c.id}))} />
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                {/* 3. Box */}
                                <section>
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-sm font-bold">3</span>
                                        <h2 className="text-xl font-bold text-slate-800">Box</h2>
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        {compatibleBoxes.map(b => (
                                            <SelectionCard key={b.id} item={b} isSelected={state.selectedBoxId === b.id} onSelect={() => setState(p => ({...p, selectedBoxId: b.id}))} />
                                        ))}
                                    </div>
                                </section>

                                {/* 4. Mini */}
                                <section>
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-sm font-bold">4</span>
                                        <h2 className="text-xl font-bold text-slate-800">Mini Album</h2>
                                    </div>
                                    <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm mb-6">
                                        <div className="flex justify-between items-center">
                                            <div>
<<<<<<< HEAD
                                                <label className="font-semibold text-slate-700 block">Quantità Totale</label>
                                                <p className="text-xs text-slate-400 mt-1">Inclusi nel contratto: {state.contract.includedMinis}</p>
=======
                                                <label className="font-semibold text-slate-700 block">Quantità</label>
                                                <p className="text-xs text-slate-400 mt-1">{INCLUDED_MINIS} inclusi. Extra a €50.00 cad.</p>
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                            </div>
                                            <div className="flex items-center gap-4 bg-slate-50 p-2 rounded-lg border border-slate-200">
                                                <button onClick={() => setState(p => ({...p, miniCount: Math.max(0, p.miniCount - 1)}))} className="w-10 h-10 rounded-full bg-white border border-slate-300 font-bold hover:text-indigo-600">-</button>
                                                <span className="text-xl font-bold text-indigo-900 w-12 text-center">{state.miniCount}</span>
                                                <button onClick={() => setState(p => ({...p, miniCount: p.miniCount + 1}))} className="w-10 h-10 rounded-full bg-indigo-600 text-white font-bold hover:bg-indigo-700">+</button>
                                            </div>
                                        </div>
                                    </div>
                                    {state.miniCount > 0 && (
                                        <div className="space-y-6">
                                            <div>
                                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Costa Mini (Prezzo Cad.)</h3>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
<<<<<<< HEAD
                                                    {MINI_SPINE_OPTIONS.map(s => (
=======
                                                    {SPINE_OPTIONS.map(s => (
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                                        <SelectionCard key={s.id} item={s} isSelected={state.selectedMiniSpineId === s.id} onSelect={() => setState(p => ({...p, selectedMiniSpineId: s.id}))} />
                                                    ))}
                                                </div>
                                            </div>
                                            <div>
                                                <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Copertina Mini (Prezzo Cad.)</h3>
                                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                                                    {MINI_COVER_OPTIONS.map(o => (
                                                        <SelectionCard key={o.id} item={o} isSelected={state.selectedMiniCoverId === o.id} onSelect={() => setState(p => ({...p, selectedMiniCoverId: o.id}))} />
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </section>

                                {/* 5. Extras */}
                                <section>
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-sm font-bold">5</span>
                                        <h2 className="text-xl font-bold text-slate-800">Extra</h2>
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                        {EXTRAS.map(extra => (
                                            <SelectionCard 
                                                key={extra.id} item={extra} 
                                                isSelected={!!state.extras[extra.id]} 
                                                onSelect={() => !extra.allowQuantity && setState(p => ({...p, extras: {...p.extras, [extra.id]: p.extras[extra.id] ? 0 : 1}}))}
                                                quantity={extra.allowQuantity ? (state.extras[extra.id] || 0) : undefined}
                                                onQuantityChange={(q) => setState(p => ({...p, extras: {...p.extras, [extra.id]: q}}))}
<<<<<<< HEAD
                                                // Nuove props per "Incluso nel contratto"
                                                isIncluded={state.includedExtraIds.includes(extra.id)}
                                                onToggleIncluded={(checked) => toggleExtraIncluded(extra.id, checked)}
=======
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                            />
                                        ))}
                                    </div>
                                </section>
                            </div>

                            <div className="lg:col-span-4">
                                <Summary 
<<<<<<< HEAD
                                    contract={state.contract} album={selectedAlbum} spreadCount={state.spreadCount}
                                    cover={selectedCover} spine={selectedSpine} box={selectedBox}
                                    extras={selectedExtrasList} includedExtraIds={state.includedExtraIds}
                                    miniCount={state.miniCount}
=======
                                    album={selectedAlbum} isBasicPackage={state.isBasicPackage} spreadCount={state.spreadCount}
                                    cover={selectedCover} spine={selectedSpine} box={selectedBox}
                                    extras={selectedExtrasList} miniCount={state.miniCount}
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                                    miniCover={selectedMiniCover} miniSpine={selectedMiniSpine} onReset={handleReset}
                                />
                            </div>
                        </div>
                    </main>
<<<<<<< HEAD
                    <footer className="bg-white border-t border-slate-200 mt-auto py-6 text-center no-print">
=======
                    <footer className="bg-white border-t border-slate-200 mt-auto py-6 text-center">
>>>>>>> 9cf36f6663e4c289bdf9e36d9a32858bf57046ad
                        <p className="text-slate-400 font-medium text-sm">Developed with ❤️ by Angelo</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
    
